<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
    }
    
    body {
      display: flex;
      flex-direction: column;
      background-image: url("/bg/background.jpg");
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      color: #000;
    }

    header {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      position: relative;
    }

    .header-title {
      text-align: center;
      flex-grow: 1;
    }

    .left { display: flex; align-items: center; }
    .logo { height: 40px; margin-right: 10px; }

    .right {
      display: flex;
      align-items: center;
      position: absolute;
      right: 20px;
    }

    .right button {
      margin-left: 10px;
      padding: 8px 15px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }

    .update-btn { background-color: #28a745; color: white; }
    .logout-btn { background-color: #dc3545; color: white; }

    .main {
      display: flex;
      flex: 1;
    }

    .sidebar {
      width: 250px;
      background-color: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 20px;
      height: calc(100vh - 60px);
    }

    .sidebar h3 {
      margin-top: 20px;
      border-bottom: 1px solid #ccc;
      padding-bottom: 5px;
      font-size: 16px;
    }

    .sidebar button {
      display: block;
      width: 100%;
      background: #007799;
      color: white;
      border: none;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      cursor: pointer;
      text-align: left;
    }

    .sidebar button:hover {
      background: #0099bb;
    }

    .content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .content-blank {
      color: rgba(255, 255, 255, 0.7);
      font-size: 1.5rem;
    }

    section {
      background: rgba(255, 255, 255, 0.9);
      margin: 0 auto;
      padding: 20px;
      border-radius: 10px;
      width: 100%;
      max-width: 1000px;
      display: none;
      box-sizing: border-box;
    }

    form input, form select, form button {
      display: block;
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      max-width: 400px;
    }

    .table-style {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }

    .table-style th,
    .table-style td {
      border: 1px solid #999;
      padding: 10px;
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
      background: #fff;
    }

    #profileCard {
      display: none;
      position: absolute;
      right: 20px;
      top: 60px;
      background: rgb(9, 216, 223);
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      z-index: 100;
      color: rgb(1, 6, 7);
      width: 200px;
    }

    #profileImage {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      object-fit: cover;
      margin-left: 10px;
    }

    footer {
  text-align: center;
  padding: 10px;
  background: #222;
  color: white;
  width: 100%;
  position: fixed;
  bottom: 0;
  left: 0;
  z-index: 100;
}

    /* Responsive table */
    @media (max-width: 768px) {
      table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
      
      .right {
        position: static;
        margin-top: 10px;
      }
      
      header {
        flex-direction: column;
      }
    }

    /* Shift Report Specific Styles */
    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 5px;
    }

    .filters label {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .filters input, .filters select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .actions {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .actions button {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      background: #007799;
      color: white;
      cursor: pointer;
    }

    .actions button:hover {
      opacity: 0.9;
    }

    
  /* Add these styles to your existing CSS */
  html {
    overflow: hidden;
    height: 100%;
  }
  
  body {
    overflow: hidden;
    height: 100%;
  }
  
  .main {
    display: flex;
    flex: 1;
    overflow: hidden;
  }
  
  .content {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }
  
  section {
    background: rgba(24, 211, 224, 0.9);
    margin: 0 auto;
    padding: 20px;
    border-radius: 10px;
    width: 100%;
    max-width: 1000px;
    display: none;
    box-sizing: border-box;
    max-height: calc(100vh - 160px);
    overflow-y: auto;
  }
  
  /* Add smooth scrolling behavior */
  html {
    scroll-behavior: smooth;
  }


    /* Long Body Report Styles */
    .long-body-filter-box {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 5px;
    }

    .long-body-filter-box label {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .long-body-filter-box input, 
    .long-body-filter-box select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .long-body-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .long-body-actions button {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      background: #007799;
      color: white;
      cursor: pointer;
    }

    .long-body-actions button:hover {
      opacity: 0.9;
    }

    #longBodyReportTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    #longBodyReportTable th, 
    #longBodyReportTable td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      background: #fff;
    }

    /* Wood Bill Report Styles */
    .wood-bill-filter-box {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 5px;
    }

    .wood-bill-filter-box label {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .wood-bill-filter-box input, 
    .wood-bill-filter-box select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .wood-bill-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .wood-bill-actions button {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      background: #007799;
      color: white;
      cursor: pointer;
    }

    .wood-bill-actions button:hover {
      opacity: 0.9;
    }

    #woodBillReportTable {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    #woodBillReportTable th, 
    #woodBillReportTable td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
      background: #fff;
    }

    /* Print-specific styles */
    @media print {
      body * {
        visibility: hidden;
      }
      #dailyShiftReport, #dailyShiftReport * {
        visibility: visible;
      }
      #dailyShiftReport {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        background: white;
        padding: 0;
        margin: 0;
      }
      .filters, .actions {
        display: none !important;
      }
      
      /* Print layout for shift reports */
      .print-page {
        page-break-after: always;
        height: 297mm;
        width: 210mm;
        padding: 15mm;
        box-sizing: border-box;
      }
      
      .print-shift-report {
        height: 50%;
        margin-bottom: 10mm;
      }
      
      .print-company-header {
        text-align: center;
        margin-bottom: 5mm;
        border-bottom: 1px solid #000;
        padding-bottom: 2mm;
      }
      
      .print-company-name {
        font-size: 16pt;
        font-weight: bold;
      }
      
      .print-company-address {
        font-size: 10pt;
      }
      
      .print-report-title {
        text-align: center;
        font-size: 14pt;
        margin: 5mm 0;
        font-weight: bold;
      }
      
      .print-report-details {
        display: flex;
        justify-content: space-between;
        margin-bottom: 3mm;
        font-size: 10pt;
      }
      
      .print-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 10pt;
        margin-bottom: 3mm;
      }
      
      .print-table th, 
      .print-table td {
        border: 1px solid #000;
        padding: 2mm;
        text-align: center;
      }
      
      .print-total-row {
        font-weight: bold;
      }
    }

    /* Token Management Styles */
        .card-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .status-active {
            color: green;
            font-weight: bold;
        }
        .status-inactive {
            color: red;
            font-weight: bold;
        }
        .status-lost {
            color: orange;
            font-weight: bold;
        }
        .management-btn {
            margin: 5px;
            min-width: 200px;
        }
        .view-btn {
            margin: 5px;
            min-width: 150px;
        }
        #totalQuantity {
            font-size: 1.5rem;
            font-weight: bold;
            color: #0d6efd;
        }
  </style>
</head>
<body>

<header>
  <div class="left">
    <img src="assets/logo.png" class="logo">
    <div class="header-title">BALAJI ACTION BUILDEWELL PRIVATE LIMITED</div>
  </div>
  <div class="right">
    <img id="profileImage" src="assets/profile.png" onclick="toggleProfile()">
    <div id="profileCard"></div>
    <button class="update-btn" onclick="toggleSection('postUpdate')">Post Update</button>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
</header>

<div class="main">
  <div class="sidebar">
    <h3>User Management</h3>
    <button onclick="toggleSection('createUser')">➕ Create User</button>
    <button onclick="toggleSection('showUsers')">👥 Show All Users</button>

 <h3>Token Card Management</h3>
<button onclick="toggleSection('tokenManagement')">🪙 Manage Token Cards</button>

    <h3>Upload Section</h3>
    <button onclick="toggleSection('uploadBackground')">🖼️ Upload Background</button>
    <button onclick="toggleSection('excelUpload')">📊 Upload Excel</button>
    
    <h3>All Reports</h3>
    <button onclick="toggleSection('dailyShiftReport')">📅 Daily Shift Report</button>
    <button onclick="toggleSection('methanolWeightReport')">⚖️ Methanol Weight Report</button>
    <button onclick="toggleSection('longBodyWeightReport')">📊 Long Body Weight Report</button>
    <button onclick="toggleSection('woodBillReport')">🌲 Wood Bill Submit</button>
  </div>

  <div class="content">
    <!-- Blank state initially -->
    <div class="content-blank" id="blankContent">
      easyGate Admin Page View "Do any activity carefully".
    </div>
    
    <!-- Post Update Section -->
    <section id="postUpdate">
      <h3>📢 Post an Update</h3>
      <form id="updateForm">
        <input type="text" id="updateTitle" placeholder="Enter update title" required>
        <textarea id="updateMessage" placeholder="Write your message..." required style="width:100%; min-height:150px; padding:10px; margin-bottom:10px;"></textarea>
        <input type="file" id="updateImage" accept="image/*">
        <button type="button" onclick="submitUpdate()">Submit</button>
        <button type="button" onclick="hideAllSections()">Cancel</button>
      </form>
    </section>

    <!-- Create User -->
    <section id="createUser">
      <h3>Create New User</h3>
      <form id="userForm" enctype="multipart/form-data">
        <input type="hidden" name="userIdUpdate" id="userIdUpdate" value="">
        <input type="text" name="username" placeholder="Username" required>
        <input type="text" name="userId" placeholder="User ID" required>
        <input type="text" name="department" placeholder="Department" required>
        <input type="text" name="designation" placeholder="Designation" required>
        <input type="text" name="mobile" placeholder="Mobile No." required>
        <input type="email" name="email" placeholder="Email" required>
        <select name="role" required>
          <option value="user">User</option>
          <option value="admin">Admin</option>
        </select>
        <input type="password" name="password" placeholder="Password">
        <input type="file" name="profilePic" accept="image/*">
        <button type="submit">Save</button>
      </form>
      <p id="msg"></p>
    </section>

    <!-- Show Users -->
    <section id="showUsers">
      <h3>All Users</h3>
      <table id="usersTable">
        <thead>
          <tr>
            <th>Username</th>
            <th>User ID</th>
            <th>Department</th>
            <th>Designation</th>
            <th>Mobile</th>
            <th>Email</th>
            <th>Role</th>
            <th>Profile Pic</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Upload Background -->
    <section id="uploadBackground">
      <h3>Upload Background</h3>
      <form id="backgroundForm" enctype="multipart/form-data">
        <input type="file" name="background" required />
        <button type="submit">Upload Background</button>
      </form>
    </section>

    <!-- Upload Excel -->
    <section id="excelUpload">
      <h3>Upload Excel File</h3>
      <form id="excelForm" enctype="multipart/form-data">
        <select name="category" required>
          <option value="">Select Category</option>
          <option value="WOOD PO">WOOD PO</option>
          <option value="CONTACTS">CONTACTS</option>
          <option value="ID PASSWORD">ID PASSWORD</option>
          <option value="SHIFT SCHEDULE">SHIFT SCHEDULE</option>
          <option value="T-CODE">T-CODE</option>
        </select>
        <input type="file" name="excelFile" accept=".xlsx" required>
        <button type="submit">Upload</button>
      </form>
      <p id="excelMsg"></p>
    </section>
    
    <section id="tokenManagement">
    <div class="container mt-4">
        <h1 class="text-center mb-4">🪙 Token Card Management System</h1>
        
        <!-- Plant Selection -->
        <div class="row mb-4">
            <div class="col-md-6 offset-md-3">
                <label for="plantSelect" class="form-label">Select Plant:</label>
                <select class="form-select" id="plantSelect">
                    <option value="">-- Select Plant --</option>
                    <option value="C2">C2</option>
                    <option value="C3">C3</option>
                    <option value="C34A">C34A</option>
                </select>
            </div>
        </div>
        
        <!-- Main Content (shown after plant selection) -->
        <div id="mainContent" style="display: none;">
            <!-- Management Buttons -->
            <div class="row mb-4">
                <div class="col-12 text-center">
                    <button class="btn btn-primary management-btn" onclick="showSection('tokenCardSection')">Token Card</button>
                    <button class="btn btn-info management-btn" disabled>
                        Total Token Card Quantity: <span id="totalQuantity">0</span>
                    </button>
                    <button class="btn btn-warning management-btn" onclick="showSection('inactiveTokenSection')">Inactive/Error Token Card</button>
                    <button class="btn btn-danger management-btn" onclick="showSection('lossTokenSection')">Loss Token Card</button>
                    <button class="btn btn-success management-btn" onclick="showSection('activatedTokenSection')">Activated Error Tokens</button>
                </div>
            </div>
            
            <!-- View Data Buttons -->
            <div class="row mb-4">
                <div class="col-12 text-center">
                    <button class="btn btn-outline-primary view-btn" onclick="viewTokenQuantity()">Token Card Quantity</button>
                    <button class="btn btn-outline-secondary view-btn" onclick="viewTotalTokens()">Total Token Card with Number</button>
                    <button class="btn btn-outline-warning view-btn" onclick="viewInactiveTokens()">Inactive Token Cards</button>
                    <button class="btn btn-outline-danger view-btn" onclick="viewLostTokens()">Lost Token Card</button>
                    <button class="btn btn-outline-success view-btn" onclick="viewActivatedTokens()">Activated Token Card</button>
                </div>
            </div>
            
            <!-- Token Card Section -->
            <div id="tokenCardSection" class="card-section">
                <h3>Token Card Management</h3>
                <div class="mb-3">
                    <button class="btn btn-sm btn-primary" onclick="addNewTokenRow()">Add New Token</button>
                </div>
                <table id="tokenCardTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Token Card Number</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
                <div class="text-end mt-3">
                    <button class="btn btn-success" onclick="saveTokenCards()">Save All Changes</button>
                </div>
            </div>
            
            <!-- Inactive/Error Token Section -->
            <div id="inactiveTokenSection" class="card-section">
                <h3>Inactive/Error Token Cards</h3>
                <table id="inactiveTokenTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Token Card Number</th>
                            <th>Problem Description</th>
                            <th>Reported Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
                <div class="text-end mt-3">
                    <button class="btn btn-success" onclick="saveInactiveTokens()">Save All Changes</button>
                </div>
            </div>
            
            <!-- Loss Token Section -->
            <div id="lossTokenSection" class="card-section">
                <h3>Loss Token Cards</h3>
                <table id="lossTokenTable" class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Token Card Number</th>
            <th>Status</th>
            <th>Reported Date</th>
            <th>Reported By</th> <!-- New Column -->
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows will be added dynamically -->
    </tbody>
</table>
            
            <!-- Activated Tokens Section -->
            <div id="activatedTokenSection" class="card-section">
                <h3>Activated Error Tokens</h3>
                <div class="mb-3">
                    <button class="btn btn-sm btn-primary" onclick="addNewActivatedTokenRow()">Add Activated Token</button>
                </div>
                <table id="activatedTokenTable" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Token Card Number</th>
                            <th>Activated Date</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
                <div class="text-end mt-3">
                    <button class="btn btn-success" onclick="saveActivatedTokens()">Save All Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="viewDataModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewDataModalTitle">Data View</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="viewDataModalBody">
                    <!-- Content will be loaded dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Daily Shift Report Section -->
    <section id="dailyShiftReport">
      <h2>✨ VIEW SHIFT REPORT ✨</h2>
      
      <div class="filters">
        <div>
          <label>From Date:
            <input type="date" id="fromDate">
          </label>
        </div>
        <div>
          <label>To Date:
            <input type="date" id="toDate">
          </label>
        </div>
        <div>
          <label>Plant:
            <select id="filterPlant">
              <option value="">ALL</option>
              <option value="C34A">C34A</option>
              <option value="C2">C2</option>
              <option value="C3">C3</option>
            </select>
          </label>
        </div>
        <div>
          <label>Shift:
            <select id="filterShift">
              <option value="">ALL</option>
              <option value="A">A</option>
              <option value="B">B</option>
              <option value="C">C</option>
            </select>
          </label>
        </div>
      </div>
      
      <div class="actions">
        <button onclick="fetchReports()">🔍 View Report</button>
        <button onclick="exportShiftToExcel()">📤 Export Excel</button>
        <button onclick="printShiftReports()">🖨️ Print</button>
      </div>
      
      <div id="reportContainer"></div>
    </section>
    
    <!-- Methanol Weight Report Section -->
    <section id="methanolWeightReport">
      <h2>⚖️ METHANOL WEIGHT REPORT</h2>
      
      <div class="filter-box">
        <label>
          From Date
          <input type="date" id="methanolFromDate">
        </label>
        <label>
          To Date
          <input type="date" id="methanolToDate">
        </label>
        <label>
          Submitted By
          <select id="methanolNameFilter">
            <option value="">All</option>
          </select>
        </label>
        <button onclick="fetchMethanolReports()" class="view-report-btn">🔍 View Report</button>
        <button onclick="exportMethanolToExcel()">📤 Export to Excel</button>
      </div>

      <table id="methanolReportTable">
        <thead>
          <tr>
            <th>S.NO</th>
            <th>DATE</th>
            <th>VEHICLE NO.</th>
            <th>MATERIAL</th>
            <th>OUTSIDE WEIGHT</th>
            <th>100 MT WEIGHT</th>
            <th>DIFFERENCE</th>
            <th>SUBMITTED BY</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
    
    <!-- Long Body Weight Report Section -->
    <section id="longBodyWeightReport">
      <h2>📊 LONG BODY WEIGHT REPORT</h2>
      
      <div class="long-body-filter-box">
        <div>
          <label>From Date:
            <input type="date" id="longBodyFromDate">
          </label>
        </div>
        <div>
          <label>To Date:
            <input type="date" id="longBodyToDate">
          </label>
        </div>
        <div>
          <label>Vehicle No:
            <input type="text" id="longBodyVehicleFilter" placeholder="Filter by vehicle">
          </label>
        </div>
        <div>
          <label>Submitted By:
            <select id="longBodyNameFilter">
              <option value="">All</option>
            </select>
          </label>
        </div>
      </div>
      
      <div class="long-body-actions">
        <button onclick="fetchLongBodyReports()">🔍 View Report</button>
        <button onclick="exportLongBodyToExcel()">📤 Export Excel</button>
        <button onclick="printLongBodyReports()">🖨️ Print</button>
      </div>
      
      <table id="longBodyReportTable">
        <thead>
          <tr>
            <th>S.NO</th>
            <th>DATE</th>
            <th>VEHICLE NO.</th>
            <th>MATERIAL</th>
            <th>OUTSIDE WEIGHT</th>
            <th>80 MT OLD</th>
            <th>80 MT NEW</th>
            <th>DIFFERENCE (OLD - NEW)</th>
            <th>SUBMITTED BY</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
      
    <!-- Wood Bill Submit Section -->
<section id="woodBillReport">
  <h2>🌲 WOOD BILL SUBMIT REPORT</h2>
  
  <!-- Filter Box -->
  <div class="wood-bill-filter-box">
    <div>
      <label>From Date:
        <input type="date" id="woodBillFromDate">
      </label>
    </div>
    <div>
      <label>To Date:
        <input type="date" id="woodBillToDate">
      </label>
    </div>
    <div>
      <label>Receiver:
        <select id="woodBillReceiverFilter">
          <option value="">All</option>
        </select>
      </label>
    </div>
    <div>
      <label>Submitted By:
        <select id="woodBillSubmittedByFilter">
          <option value="">All</option>
        </select>
      </label>
    </div>
    <div>
      <label>Plant:
        <select id="woodBillPlantFilter">
          <option value="">All</option>
          <option value="C34A">C34A</option>
          <option value="C2">C2</option>
          <option value="C3">C3</option>
        </select>
      </label>
    </div>
  </div>
  
  <!-- Action Buttons -->
  <div class="wood-bill-actions">
    <button onclick="fetchWoodBillReports()">🔍 View Report</button>
    <button onclick="exportWoodBillToExcel()">📤 Export Excel</button>
    <button onclick="printWoodBillReports()">🖨️ Print</button>
  </div>
  
  <!-- Table View -->
  <table id="woodBillReportTable">
    <thead>
      <tr>
        <th>S.NO</th>
        <th>SAP DATE</th>
        <th>BILL SUBMIT DATE</th>
        <th>QUANTITY</th>
        <th>SUBMIT TIME</th>
        <th>RECEIVER NAME</th>
        <th>SUBMITTED BY</th>
        <th>PLANT</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<footer>
  &copy; All rights reserved easyGate
</footer>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script>
  function hideAllSections() {
    const sections = document.querySelectorAll('.content section');
    sections.forEach(section => {
      section.style.display = 'none';
    });
    document.getElementById('blankContent').style.display = 'block';
  }

  function toggleSection(id) {
    document.getElementById('blankContent').style.display = 'none';
    const sections = document.querySelectorAll('.content section');
    sections.forEach(section => {
      section.style.display = 'none';
      section.style.overflowY = 'hidden';
    });
    
    const activeSection = document.getElementById(id);
    activeSection.style.display = 'block';
    
    setTimeout(() => {
      activeSection.style.overflowY = 'auto';
      activeSection.scrollTop = 0;
    }, 50);
    
    document.querySelector('.content').scrollTop = 0;

    if (id === 'showUsers') fetchUsers();
    if (id === 'dailyShiftReport') {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('fromDate').value = today;
      document.getElementById('toDate').value = today;
      fetchReports();
    }
    if (id === 'longBodyWeightReport') {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('longBodyFromDate').value = today;
      document.getElementById('longBodyToDate').value = today;
      fetchLongBodyReports();
    }
    if (id === 'methanolWeightReport') {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('methanolFromDate').value = today;
      document.getElementById('methanolToDate').value = today;
      fetchMethanolReports();
    }
    if (id === 'woodBillReport') {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('woodBillFromDate').value = today;
      document.getElementById('woodBillToDate').value = today;
      fetchWoodBillReports();
    }
  }

  function logout() {
    localStorage.clear();
    window.location.href = 'index.html';
  }

  function toggleProfile() {
    const card = document.getElementById("profileCard");
    card.style.display = card.style.display === "block" ? "none" : "block";
  }

  async function fetchUsers() {
  try {
    const res = await fetch("/api/users");
    const users = await res.json();
    const tbody = document.querySelector("#usersTable tbody");
    tbody.innerHTML = "";

    users.forEach(u => {
      const profilePicUrl = u.profilePic && u.profilePic.startsWith("http")
        ? u.profilePic
        : "assets/profile.png";

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${u.username}</td>
        <td>${u.userId}</td>
        <td>${u.department}</td>
        <td>${u.designation}</td>
        <td>${u.mobile}</td>
        <td>${u.email}</td>
        <td>${u.role}</td>
        <td>
          <img src="${profilePicUrl}" width="40" height="40" 
               style="border-radius:50%; object-fit:cover;">
        </td>
        <td>
          <button onclick='editUser(${JSON.stringify(u)})'>Edit</button>
          <button onclick="deleteUser('${u._id}')">Delete</button>
        </td>`;
      tbody.appendChild(row);
    });
  } catch (err) {
    console.error("Fetch users error:", err);
    alert("Failed to load users");
  }
}

  async function deleteUser(userId) {
    if (!confirm("Are you sure you want to delete this user?")) return;
    try {
      const res = await fetch(`/api/delete-user/${userId}`, { method: "DELETE" });
      const result = await res.json();
      alert(result.message);
      if (result.success) fetchUsers();
    } catch (err) {
      console.error("Delete error:", err);
      alert("Delete failed");
    }
  }

  function editUser(user) {
    toggleSection('createUser');
    const form = document.getElementById("userForm");
    form.reset();
    form.username.value = user.username;
    form.userId.value = user.userId;
    form.userId.disabled = true;
    document.getElementById("userIdUpdate").value = user._id;
    form.department.value = user.department;
    form.designation.value = user.designation;
    form.mobile.value = user.mobile;
    form.email.value = user.email;
    form.role.value = user.role;
    form.password.required = false;
  }

  document.getElementById("userForm").addEventListener("submit", async function (e) {
    e.preventDefault();
    try {
      const formData = new FormData(this);
      const res = await fetch("/api/create-user", {
        method: "POST",
        body: formData
      });
      const result = await res.json();
      document.getElementById("msg").innerText = result.message;
      if (result.success) this.reset();
    } catch (err) {
      console.error("Create user error:", err);
      alert("Failed to create user");
    }
  });

  document.getElementById("backgroundForm").addEventListener("submit", async function (e) {
    e.preventDefault();
    try {
      const formData = new FormData(this);
      const res = await fetch("/api/upload-background", {
        method: "POST",
        body: formData
      });
      const result = await res.json();
      alert(result.message);
    } catch (err) {
      console.error("Upload background error:", err);
      alert("Failed to upload background");
    }
  });

  document.getElementById("excelForm").addEventListener("submit", async function (e) {
  e.preventDefault();
  try {
    const formData = new FormData(this);

    const token = localStorage.getItem("token"); // ✅ get token

    const res = await fetch("/api/upload-excel", {
      method: "POST",
      body: formData,
      headers: {
        Authorization: `Bearer ${token}` // ✅ add token to headers
      }
    });

    const result = await res.json();
    document.getElementById("excelMsg").innerText = result.message;
    if (result.success) this.reset();
  } catch (err) {
    console.error("Upload excel error:", err);
    alert("Failed to upload Excel");
  }
});


  async function loadProfile() {
    const token = localStorage.getItem("token");
    if (!token) return logout();
    try {
      const res = await fetch("/api/me", {
        headers: { Authorization: `Bearer ${token}` }
      });
      const result = await res.json();
      if (!result.success) return logout();

      const user = result.user;
      const profileImg = document.getElementById("profileImage");
      profileImg.src = user.profilePic || "assets/profile.png";
      document.getElementById("profileCard").innerHTML = `
        <strong>${user.username}</strong><br>
        <small>${user.role}</small><hr>
        <p><strong>User ID:</strong> ${user.userId}</p>
        <p><strong>Email:</strong> ${user.email}</p>
        <p><strong>Mobile:</strong> ${user.mobile}</p>
        <p><strong>Dept:</strong> ${user.department}</p>
        <p><strong>Desig:</strong> ${user.designation}</p>`;
    } catch (err) {
      console.error("Profile error:", err);
      logout();
    }
  }

  async function submitUpdate() {
    const title = document.getElementById("updateTitle").value.trim();
    const message = document.getElementById("updateMessage").value.trim();
    const imageFile = document.getElementById("updateImage").files[0];
    if (!title || !message) return alert("Please fill in both title and message");

    try {
      const formData = new FormData();
      formData.append("title", title);
      formData.append("message", message);
      if (imageFile) formData.append("image", imageFile);

      const res = await fetch("/api/updates", {
        method: "POST",
        body: formData
      });

      const data = await res.json();
      alert(data.message || "Update posted.");
      document.getElementById("updateTitle").value = "";
      document.getElementById("updateMessage").value = "";
      document.getElementById("updateImage").value = "";
      hideAllSections();
    } catch (err) {
      console.error("Update post error:", err);
      alert("Failed to post update");
    }
  }

  async function fetchReports() {
    const fromDate = document.getElementById("fromDate").value;
    const toDate = document.getElementById("toDate").value;
    const plant = document.getElementById("filterPlant").value;
    const shift = document.getElementById("filterShift").value;

    try {
      const res = await fetch("/api/reports/shift");
      const data = await res.json();

      const filtered = data.filter(r => {
        const reportDate = new Date(r.date);
        if (fromDate && reportDate < new Date(fromDate)) return false;
        if (toDate && reportDate > new Date(toDate)) return false;
        if (plant && r.plant !== plant) return false;
        if (shift && r.shift !== shift) return false;
        return true;
      });

      const container = document.getElementById("reportContainer");
      container.innerHTML = "";

      filtered.forEach(report => {
        const totalSAP = (report.woodSAP || 0) + (report.storeSAP || 0) + (report.dispatchSAP || 0);
        const totalToken = (report.inStockTokens || 0) + (report.issuedTokens || 0);

        const html = `
          <table class="table-style">
            <thead>
              <tr>
                <th colspan="5" style="text-align:left; background:#555; color:white;">
                  Date: ${report.date || "-"} | Plant: ${report.plant || "-"} | Shift: ${report.shift || "-"} | Shift Person: ${report.shiftPerson || "-"}
                </th>
              </tr>
              <tr>
                <th>Material</th>
                <th>Received Bills by Security</th>
                <th>SAP Done</th>
                <th>Pending</th>
                <th>Remarks</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>WOOD</td><td>${report.woodReceived || 0}</td><td>${report.woodSAP || 0}</td><td>${report.woodPending || 0}</td><td></td></tr>
              <tr><td>STORE</td><td>${report.storeReceived || 0}</td><td>${report.storeSAP || 0}</td><td>${report.storePending || 0}</td><td></td></tr>
              <tr><td>DISPATCH</td><td>${report.dispatchReceived || 0}</td><td>${report.dispatchSAP || 0}</td><td>${report.dispatchPending || 0}</td><td></td></tr>
              <tr><td><strong>Total SAP Done</strong></td><td colspan="4">${totalSAP}</td></tr>
              <tr><td>In Stock Token Card</td><td colspan="4">${report.inStockTokens || 0}</td></tr>
              <tr><td>Issued Token Card</td><td colspan="4">${report.issuedTokens || 0}</td></tr>
              <tr><td>Total Token Card</td><td colspan="4">${totalToken}</td></tr>
              <tr><td><strong>Loss/Damage Token</strong></td><td colspan="4">${report.lossTokens || 0}</td></tr>
              <tr><td>Remarks</td><td colspan="4">${report.remarks || ''}</td></tr>
            </tbody>
          </table>`;
        
        container.innerHTML += html;
      });

      const printContainer = document.createElement("div");
      printContainer.id = "printContainer";
      printContainer.style.display = "none";
      document.body.appendChild(printContainer);

      let printHTML = '';
      let shiftCount = 0;
      
      filtered.forEach((report, index) => {
        const totalSAP = (report.woodSAP || 0) + (report.storeSAP || 0) + (report.dispatchSAP || 0);
        const totalToken = (report.inStockTokens || 0) + (report.issuedTokens || 0);

        if (shiftCount % 2 === 0) {
          printHTML += `<div class="print-page">`;
        }

        printHTML += `
          <div class="print-shift-report">
            <div class="print-company-header">
              <div class="print-company-name">Balaji Action Buildwell Private Ltd.</div>
              <div class="print-company-address">
                C34, C34A TO D C-3, C6A TO C, PLOT 5, ELDECO SIDCUL INDUSTRIAL PARK, SITARGANJ PIN- 262405
              </div>
            </div>
            
            <div class="print-report-title">SHIFT REPORT</div>
            
            <div class="print-report-details">
              <div><strong>Date:</strong> ${report.date || "-"}</div>
              <div><strong>Plant:</strong> ${report.plant || "-"}</div>
              <div><strong>Shift:</strong> ${report.shift || "-"}</div>
              <div><strong>Shift Person:</strong> ${report.shiftPerson || "-"}</div>
            </div>
            
            <table class="print-table">
              <thead>
                <tr>
                  <th>Material</th>
                  <th>Received</th>
                  <th>SAP Done</th>
                  <th>Pending</th>
                  <th>Remarks</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>WOOD</td>
                  <td>${report.woodReceived || 0}</td>
                  <td>${report.woodSAP || 0}</td>
                  <td>${report.woodPending || 0}</td>
                  <td></td>
                </tr>
                <tr>
                  <td>STORE</td>
                  <td>${report.storeReceived || 0}</td>
                  <td>${report.storeSAP || 0}</td>
                  <td>${report.storePending || 0}</td>
                  <td></td>
                </tr>
                <tr>
                  <td>DISPATCH</td>
                  <td>${report.dispatchReceived || 0}</td>
                  <td>${report.dispatchSAP || 0}</td>
                  <td>${report.dispatchPending || 0}</td>
                  <td></td>
                </tr>
                <tr class="print-total-row">
                  <td>Total SAP Done</td>
                  <td colspan="4">${totalSAP}</td>
                </tr>
              </tbody>
            </table>
            
            <table class="print-table">
              <tr>
                <td>In Stock Token Card</td>
                <td>${report.inStockTokens || 0}</td>
              </tr>
              <tr>
                <td>Issued Token Card</td>
                <td>${report.issuedTokens || 0}</td>
              </tr>
              <tr class="print-total-row">
                <td>Total Token Card</td>
                <td>${totalToken}</td>
              </tr>
              <tr>
                <td>Loss/Damage Token</td>
                <td>${report.lossTokens || 0}</td>
              </tr>
            </table>
            
            <div style="margin-top: 3mm; font-size: 10pt;">
              <strong>Remarks:</strong> ${report.remarks || ''}
            </div>
          </div>`;

        if (shiftCount % 2 === 1 || index === filtered.length - 1) {
          printHTML += `</div>`;
        }
        
        shiftCount++;
      });

      printContainer.innerHTML = printHTML;

    } catch (err) {
      console.error("Error fetching shift reports:", err);
      alert("Failed to load shift reports");
    }
  }

  function exportShiftToExcel() {
    const fromDate = document.getElementById("fromDate").value;
    const toDate = document.getElementById("toDate").value;
    const plant = document.getElementById("filterPlant").value;
    const shift = document.getElementById("filterShift").value;

    fetch("/api/reports/shift")
      .then(res => res.json())
      .then(data => {
        const filtered = data.filter(r => {
          const reportDate = new Date(r.date);
          if (fromDate && reportDate < new Date(fromDate)) return false;
          if (toDate && reportDate > new Date(toDate)) return false;
          if (plant && r.plant !== plant) return false;
          if (shift && r.shift !== shift) return false;
          return true;
        });

        const formatted = filtered.map(r => [
          r.date || "",
          r.plant || "",
          r.shift || "",
          r.shiftPerson || "",
          r.woodReceived || 0,
          r.woodSAP || 0,
          r.woodPending || 0,
          r.storeReceived || 0,
          r.storeSAP || 0,
          r.storePending || 0,
          r.dispatchReceived || 0,
          r.dispatchSAP || 0,
          r.dispatchPending || 0,
          (r.woodSAP || 0) + (r.storeSAP || 0) + (r.dispatchSAP || 0),
          r.inStockTokens || 0,
          r.issuedTokens || 0,
          (r.inStockTokens || 0) + (r.issuedTokens || 0),
          r.lossTokens || 0,
          r.remarks || ""
        ]);

        const header = [
          "DATE",
          "PLANT",
          "SHIFT",
          "SHIFT PERSON",
          "WOOD (RECEIVED BY SECURITY)",
          "WOOD (SAP DONE)",
          "WOOD (PENDING)",
          "STORE (RECEIVED BY SECURITY)",
          "STORE (SAP DONE)",
          "STORE (PENDING)",
          "DISPATCH (RECEIVED BY SECURITY)",
          "DISPATCH (SAP DONE)",
          "DISPATCH (PENDING)",
          "TOTAL SAP DONE",
          "IN STOCK TOKEN CARD",
          "ISSUED TOKEN CARD",
          "TOTAL TOKEN CARD",
          "LOSS/DAMAGE TOKEN",
          "REMARKS"
        ];

        const ws = XLSX.utils.aoa_to_sheet([header, ...formatted]);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Shift Reports");
        XLSX.writeFile(wb, "shift_reports.xlsx");
      })
      .catch(err => {
        console.error("Excel export error:", err);
        alert("Failed to export Excel");
      });
  }

  function printShiftReports() {
    const printContainer = document.getElementById("printContainer");
    if (!printContainer) {
      alert("Please generate the report first");
      return;
    }
    
    const printContent = printContainer.cloneNode(true);
    printContent.style.display = "block";
    printContent.style.position = "absolute";
    printContent.style.left = "0";
    printContent.style.top = "0";
    
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write('<html><head><title>Shift Reports</title>');
    printWindow.document.write('<link rel="stylesheet" href="styles.css">');
    printWindow.document.write('</head><body>');
    printWindow.document.write(printContent.innerHTML);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    
    printWindow.onload = function() {
      printWindow.print();
      printWindow.close();
    };
  }

  async function fetchMethanolReports() {
    const fromDate = document.getElementById('methanolFromDate').value;
    const toDate = document.getElementById('methanolToDate').value;
    const submittedBy = document.getElementById('methanolNameFilter').value.toLowerCase();
    const tbody = document.querySelector("#methanolReportTable tbody");

    try {
      let url = '/api/methanol';
      const params = new URLSearchParams();
      if (fromDate) params.append('from', fromDate);
      if (toDate) params.append('to', toDate);
      
      if (params.toString()) {
        url += `?${params.toString()}`;
      }

      const res = await fetch(url);
      const data = await res.json();

      tbody.innerHTML = "";
      
      const nameSet = new Set();
      
      data.forEach((entry, index) => {
        if (submittedBy && (!entry.name || !entry.name.toLowerCase().includes(submittedBy))) {
          return;
        }
        
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${entry.date || "-"}</td>
          <td>${entry.vehicleNo || "-"}</td>
          <td>${entry.material || "METHANOL"}</td>
          <td>${entry.outsideWeight || "-"}</td>
          <td>${entry.mtWeight || "-"}</td>
          <td>${entry.difference || (entry.outsideWeight - entry.mtWeight).toFixed(2) || "-"}</td>
          <td>${entry.name || "-"}</td>
        `;
        tbody.appendChild(row);
        
        if (entry.name) nameSet.add(entry.name);
      });

      const nameFilter = document.getElementById("methanolNameFilter");
      nameFilter.innerHTML = '<option value="">All</option>' + 
        [...nameSet].map(name => `<option value="${name}">${name}</option>`).join('');

    } catch (err) {
      console.error("Fetch methanol reports error:", err);
      alert("Failed to load methanol reports");
    }
  }

  function exportMethanolToExcel() {
    const table = document.getElementById("methanolReportTable");
    const wb = XLSX.utils.table_to_book(table, { sheet: "MethanolReport" });
    XLSX.writeFile(wb, "methanol_weight_reports.xlsx");
  }

  async function fetchLongBodyReports() {
    const fromDate = document.getElementById('longBodyFromDate').value;
    const toDate = document.getElementById('longBodyToDate').value;
    const vehicleFilter = document.getElementById('longBodyVehicleFilter').value.toLowerCase();
    const nameFilter = document.getElementById('longBodyNameFilter').value.toLowerCase();
    const tbody = document.querySelector("#longBodyReportTable tbody");

    try {
      let url = '/api/long-body';
      const params = new URLSearchParams();
      if (fromDate) params.append('from', fromDate);
      if (toDate) params.append('to', toDate);
      
      if (params.toString()) {
        url += `?${params.toString()}`;
      }

      const res = await fetch(url);
      const data = await res.json();

      tbody.innerHTML = "";
      
      const nameSet = new Set();
      let serial = 1;
      
      data.forEach(entry => {
        if (vehicleFilter && (!entry.vehicle || !entry.vehicle.toLowerCase().includes(vehicleFilter))) {
          return;
        }
        if (nameFilter && (!entry.name || !entry.name.toLowerCase().includes(nameFilter))) {
          return;
        }
        
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${serial++}</td>
          <td>${entry.date || "-"}</td>
          <td>${entry.vehicle || "-"}</td>
          <td>${entry.material || "-"}</td>
          <td>${entry.outsideWeight || "-"}</td>
          <td>${entry.old80 || "-"}</td>
          <td>${entry.new80 || "-"}</td>
          <td>${entry.difference || "-"}</td>
          <td>${entry.name || "-"}</td>
        `;
        tbody.appendChild(row);
        
        if (entry.name) nameSet.add(entry.name);
      });

      const nameFilterDropdown = document.getElementById("longBodyNameFilter");
      nameFilterDropdown.innerHTML = '<option value="">All</option>' + 
        [...nameSet].map(name => `<option value="${name}">${name}</option>`).join('');

    } catch (err) {
      console.error("Fetch long body reports error:", err);
      alert("Failed to load long body reports");
    }
  }

  function exportLongBodyToExcel() {
    const table = document.getElementById("longBodyReportTable");
    const wb = XLSX.utils.table_to_book(table, { sheet: "LongBodyReport" });
    XLSX.writeFile(wb, "long_body_reports.xlsx");
  }

  function printLongBodyReports() {
    const printContent = document.getElementById("longBodyWeightReport").cloneNode(true);
    printContent.style.width = "100%";
    
    // Remove buttons from print
    const buttons = printContent.querySelectorAll('.long-body-actions');
    buttons.forEach(btn => btn.remove());
    
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write('<html><head><title>Long Body Weight Reports</title>');
    printWindow.document.write('<style>body { font-family: Arial; } table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid #000; padding: 8px; text-align: center; }</style>');
    printWindow.document.write('</head><body>');
    printWindow.document.write('<h1>Long Body Weight Reports</h1>');
    printWindow.document.write(printContent.innerHTML);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    
    printWindow.onload = function() {
      printWindow.print();
      printWindow.close();
    };
  }

  async function fetchWoodBillReports() {
    const fromDate = document.getElementById('woodBillFromDate').value;
    const toDate = document.getElementById('woodBillToDate').value;
    const receiver = document.getElementById('woodBillReceiverFilter').value.toLowerCase();
    const submittedBy = document.getElementById('woodBillSubmittedByFilter').value.toLowerCase();
    const plant = document.getElementById('woodBillPlantFilter').value.toLowerCase();
    
    const tbody = document.querySelector("#woodBillReportTable tbody");

    try {
      let url = '/api/wood-bill';
      const params = new URLSearchParams();
      if (fromDate) params.append('from', fromDate);
      if (toDate) params.append('to', toDate);
      
      if (params.toString()) {
        url += `?${params.toString()}`;
      }

      const res = await fetch(url);
      const data = await res.json();

      tbody.innerHTML = "";
      
      const receiverSet = new Set();
      const submittedBySet = new Set();
      let serial = 1;
      
      data.forEach(entry => {
        if (receiver && (!entry.receiverName || !entry.receiverName.toLowerCase().includes(receiver))) {
          return;
        }
        if (submittedBy && (!entry.submittedBy || !entry.submittedBy.toLowerCase().includes(submittedBy))) {
          return;
        }
        if (plant && (!entry.plant || !entry.plant.toLowerCase().includes(plant))) {
          return;
        }
        
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${serial++}</td>
          <td>${entry.sapDate || "-"}</td>
          <td>${entry.billDate || "-"}</td>
          <td>${entry.quantity || "-"}</td>
          <td>${entry.submitTime || "-"}</td>
          <td>${entry.receiverName || "-"}</td>
          <td>${entry.submittedBy || "-"}</td>
          <td>${entry.plant || "-"}</td>
        `;
        tbody.appendChild(row);
        
        if (entry.receiverName) receiverSet.add(entry.receiverName);
        if (entry.submittedBy) submittedBySet.add(entry.submittedBy);
      });

      // Populate filter dropdowns
      const receiverFilter = document.getElementById("woodBillReceiverFilter");
      receiverFilter.innerHTML = '<option value="">All</option>' + 
        [...receiverSet].map(name => `<option value="${name}">${name}</option>`).join('');

      const submittedByFilter = document.getElementById("woodBillSubmittedByFilter");
      submittedByFilter.innerHTML = '<option value="">All</option>' + 
        [...submittedBySet].map(name => `<option value="${name}">${name}</option>`).join('');

    } catch (err) {
      console.error("Fetch wood bill reports error:", err);
      alert("Failed to load wood bill reports");
    }
  }

  function exportWoodBillToExcel() {
    const table = document.getElementById("woodBillReportTable");
    const wb = XLSX.utils.table_to_book(table, { sheet: "WoodBillReport" });
    XLSX.writeFile(wb, "wood_bill_reports.xlsx");
  }

  function printWoodBillReports() {
    const printContent = document.getElementById("woodBillReport").cloneNode(true);
    printContent.style.width = "100%";
    
    // Remove buttons from print
    const buttons = printContent.querySelectorAll('.wood-bill-actions');
    buttons.forEach(btn => btn.remove());
    
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write('<html><head><title>Wood Bill Reports</title>');
    printWindow.document.write('<style>body { font-family: Arial; } table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid #000; padding: 8px; text-align: center; }</style>');
    printWindow.document.write('</head><body>');
    printWindow.document.write('<h1>Wood Bill Submit Reports</h1>');
    printWindow.document.write(printContent.innerHTML);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    
    printWindow.onload = function() {
      printWindow.print();
      printWindow.close();
    };
  }

  window.onload = function() {
    loadProfile();
    hideAllSections();
    
    // Initialize date filters
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('woodBillFromDate').value = today;
    document.getElementById('woodBillToDate').value = today;
    document.getElementById('methanolFromDate').value = today;
    document.getElementById('methanolToDate').value = today;
    document.getElementById('longBodyFromDate').value = today;
    document.getElementById('longBodyToDate').value = today;
    
    // Set initial dates for shift report if needed
    if (document.getElementById('fromDate')) {
      document.getElementById('fromDate').value = today;
      document.getElementById('toDate').value = today;
    }
  };

    // Global variables
        let currentPlant = '';
        let tokenCards = [];
        let inactiveTokens = [];
        let lossTokens = [];
        let activatedTokens = [];
        
        // Initialize DataTables
        $(document).ready(function() {
            $('#tokenCardTable').DataTable();
            $('#inactiveTokenTable').DataTable();
            $('#lossTokenTable').DataTable();
            $('#activatedTokenTable').DataTable();
            
            // Plant selection change handler
            $('#plantSelect').change(function() {
                currentPlant = $(this).val();
                if (currentPlant) {
                    $('#mainContent').show();
                    loadPlantData(currentPlant);
                } else {
                    $('#mainContent').hide();
                }
            });
        });
        
        // Load data for selected plant
        function loadPlantData(plant) {
            // In a real application, this would be an AJAX call to your backend
            console.log(`Loading data for plant: ${plant}`);
            
            // Simulate loading data from server
            setTimeout(() => {
                // Sample data - replace with actual API calls
                tokenCards = [
                    { id: 1, cardNumber: 'TC-'+plant+'-001', status: 'Active' },
                    { id: 2, cardNumber: 'TC-'+plant+'-002', status: 'Active' },
                    { id: 3, cardNumber: 'TC-'+plant+'-003', status: 'Active' },
                    { id: 4, cardNumber: 'TC-'+plant+'-004', status: 'Inactive' },
                    { id: 5, cardNumber: 'TC-'+plant+'-005', status: 'Lost' }
                ];
                
                inactiveTokens = [
                    { id: 1, tokenId: 4, cardNumber: 'TC-'+plant+'-004', problem: 'Damaged chip', reportedDate: '2023-07-15' }
                ];
                
                lossTokens = [
                    { id: 1, tokenId: 5, cardNumber: 'TC-'+plant+'-005', status: 'Lost', reportedDate: '2023-07-10' }
                ];
                
                activatedTokens = [];
                
                // Update UI with loaded data
                updateTokenCardTable();
                updateInactiveTokenTable();
                updateLossTokenTable();
                updateActivatedTokenTable();
                updateTotalQuantity();
                
            }, 500);
        }
        
        // Show/hide sections
        function showSection(sectionId) {
            $('.card-section').hide();
            $('#' + sectionId).show();
        }
        
        // Update token card table
        function updateTokenCardTable() {
            const table = $('#tokenCardTable').DataTable();
            table.clear();
            
            tokenCards.forEach(token => {
                let statusClass = '';
                if (token.status === 'Active') statusClass = 'status-active';
                else if (token.status === 'Inactive') statusClass = 'status-inactive';
                else if (token.status === 'Lost') statusClass = 'status-lost';
                
                table.row.add([
                    `<input type="text" class="form-control token-card-number" value="${token.cardNumber}" data-id="${token.id}">`,
                    `<span class="${statusClass}">${token.status}</span>`,
                    `<button class="btn btn-sm btn-danger" onclick="deleteTokenCard(${token.id})">Delete</button>`
                ]);
            });
            
            table.draw();
        }
        
        // Update inactive token table
        function updateInactiveTokenTable() {
            const table = $('#inactiveTokenTable').DataTable();
            table.clear();
            
            inactiveTokens.forEach(token => {
                table.row.add([
                    `<select class="form-select inactive-token-select" data-id="${token.id}">
                        ${tokenCards.map(t => 
                            `<option value="${t.id}" ${t.id === token.tokenId ? 'selected' : ''}>${t.cardNumber}</option>`
                        ).join('')}
                    </select>`,
                    `<input type="text" class="form-control problem-description" value="${token.problem}" data-id="${token.id}">`,
                    token.reportedDate,
                    `<button class="btn btn-sm btn-danger" onclick="deleteInactiveToken(${token.id})">Delete</button>`
                ]);
            });
            
            table.draw();
        }

// Update the sample data in loadPlantData function
lossTokens = [
    { 
        id: 1, 
        tokenId: 5, 
        cardNumber: 'TC-'+plant+'-005', 
        status: 'Lost', 
        reportedDate: '2023-07-10',
        reportedBy: 'John Doe (Shift A)'  // Added shift person info
    }
];

// Update the updateLossTokenTable function
function updateLossTokenTable() {
    const table = $('#lossTokenTable').DataTable();
    table.clear();
    
    lossTokens.forEach(token => {
        table.row.add([
            token.cardNumber,
            `<span class="status-lost">${token.status}</span>`,
            token.reportedDate,
            token.reportedBy || 'N/A',  // Display shift person's name
            `<button class="btn btn-sm btn-success" onclick="restoreLostToken(${token.id})">Restore</button>`
        ]);
    });
    
    table.draw();
}
        
        // Update activated token table
        function updateActivatedTokenTable() {
            const table = $('#activatedTokenTable').DataTable();
            table.clear();
            
            activatedTokens.forEach(token => {
                table.row.add([
                    `<select class="form-select activated-token-select" data-id="${token.id}">
                        ${inactiveTokens.map(t => 
                            `<option value="${t.id}" ${t.id === token.tokenId ? 'selected' : ''}>${t.cardNumber}</option>`
                        ).join('')}
                    </select>`,
                    new Date().toISOString().split('T')[0],
                    `<input type="text" class="form-control activation-notes" value="${token.notes || ''}" data-id="${token.id}">`,
                    `<button class="btn btn-sm btn-danger" onclick="deleteActivatedToken(${token.id})">Delete</button>`
                ]);
            });
            
            table.draw();
        }
        
        // Update total quantity display
        function updateTotalQuantity() {
            const activeCount = tokenCards.filter(t => t.status === 'Active').length;
            $('#totalQuantity').text(activeCount);
        }
        
        // Add new token row
        function addNewTokenRow() {
            const newId = tokenCards.length > 0 ? Math.max(...tokenCards.map(t => t.id)) + 1 : 1;
            tokenCards.push({
                id: newId,
                cardNumber: 'TC-'+currentPlant+'-'+(100 + newId).toString().substring(1),
                status: 'Active'
            });
            updateTokenCardTable();
        }
        
        // Add new activated token row
        function addNewActivatedTokenRow() {
            const newId = activatedTokens.length > 0 ? Math.max(...activatedTokens.map(t => t.id)) + 1 : 1;
            activatedTokens.push({
                id: newId,
                tokenId: inactiveTokens.length > 0 ? inactiveTokens[0].id : null,
                notes: ''
            });
            updateActivatedTokenTable();
        }
        
        // Delete token card
        function deleteTokenCard(id) {
            if (confirm('Are you sure you want to delete this token card?')) {
                tokenCards = tokenCards.filter(t => t.id !== id);
                updateTokenCardTable();
                updateTotalQuantity();
            }
        }
        
        // Delete inactive token
        function deleteInactiveToken(id) {
            if (confirm('Are you sure you want to delete this inactive token record?')) {
                inactiveTokens = inactiveTokens.filter(t => t.id !== id);
                updateInactiveTokenTable();
            }
        }
        
        // Delete activated token
        function deleteActivatedToken(id) {
            if (confirm('Are you sure you want to delete this activation record?')) {
                activatedTokens = activatedTokens.filter(t => t.id !== id);
                updateActivatedTokenTable();
            }
        }
        
        // Restore lost token
        function restoreLostToken(id) {
            const token = lossTokens.find(t => t.id === id);
            if (token) {
                const mainToken = tokenCards.find(t => t.id === token.tokenId);
                if (mainToken) {
                    mainToken.status = 'Active';
                    lossTokens = lossTokens.filter(t => t.id !== id);
                    updateTokenCardTable();
                    updateLossTokenTable();
                    updateTotalQuantity();
                }
            }
        }
        
        // Save token cards
        function saveTokenCards() {
            // In a real app, this would send data to the server
            alert('Token cards saved successfully!');
            console.log('Saved token cards:', tokenCards);
        }
        
        // Save inactive tokens
        function saveInactiveTokens() {
            // In a real app, this would send data to the server
            alert('Inactive tokens saved successfully!');
            console.log('Saved inactive tokens:', inactiveTokens);
        }
        
        // Save activated tokens
        function saveActivatedTokens() {
            // In a real app, this would send data to the server
            alert('Activated tokens saved successfully!');
            console.log('Saved activated tokens:', activatedTokens);
        }
        
        // View functions
        function viewTokenQuantity() {
            const activeCount = tokenCards.filter(t => t.status === 'Active').length;
            const inactiveCount = tokenCards.filter(t => t.status === 'Inactive').length;
            const lostCount = tokenCards.filter(t => t.status === 'Lost').length;
            
            const content = `
                <h4>Token Card Quantities</h4>
                <table class="table">
                    <tr><th>Active Tokens:</th><td>${activeCount}</td></tr>
                    <tr><th>Inactive Tokens:</th><td>${inactiveCount}</td></tr>
                    <tr><th>Lost Tokens:</th><td>${lostCount}</td></tr>
                    <tr><th>Total Tokens:</th><td>${tokenCards.length}</td></tr>
                </table>
            `;
            
            $('#viewDataModalTitle').text('Token Card Quantity Report');
            $('#viewDataModalBody').html(content);
            $('#viewDataModal').modal('show');
        }
        
        function viewTotalTokens() {
            const content = `
                <h4>All Token Cards</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Token Card Number</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tokenCards.map(t => `
                            <tr>
                                <td>${t.cardNumber}</td>
                                <td class="${t.status === 'Active' ? 'status-active' : t.status === 'Inactive' ? 'status-inactive' : 'status-lost'}">
                                    ${t.status}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            $('#viewDataModalTitle').text('All Token Cards');
            $('#viewDataModalBody').html(content);
            $('#viewDataModal').modal('show');
        }
        
        function viewInactiveTokens() {
            const content = `
                <h4>Inactive Token Cards</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Token Card Number</th>
                            <th>Problem Description</th>
                            <th>Reported Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${inactiveTokens.map(t => `
                            <tr>
                                <td>${t.cardNumber}</td>
                                <td>${t.problem}</td>
                                <td>${t.reportedDate}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            $('#viewDataModalTitle').text('Inactive Token Cards');
            $('#viewDataModalBody').html(content);
            $('#viewDataModal').modal('show');
        }
        
      function viewLostTokens() {
    const content = `
        <h4>Lost Token Cards</h4>
        <table class="table">
            <thead>
                <tr>
                    <th>Token Card Number</th>
                    <th>Status</th>
                    <th>Reported Date</th>
                    <th>Reported By</th>
                </tr>
            </thead>
            <tbody>
                ${lossTokens.map(t => `
                    <tr>
                        <td>${t.cardNumber}</td>
                        <td class="status-lost">${t.status}</td>
                        <td>${t.reportedDate}</td>
                        <td>${t.reportedBy || 'N/A'}</td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
    
    $('#viewDataModalTitle').text('Lost Token Cards');
    $('#viewDataModalBody').html(content);
    $('#viewDataModal').modal('show');
}        
        function viewActivatedTokens() {
            const content = `
                <h4>Activated Token Cards</h4>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Token Card Number</th>
                            <th>Activated Date</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${activatedTokens.map(t => `
                            <tr>
                                <td>${t.cardNumber}</td>
                                <td>${t.activatedDate || new Date().toISOString().split('T')[0]}</td>
                                <td>${t.notes || ''}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            $('#viewDataModalTitle').text('Activated Token Cards');
            $('#viewDataModalBody').html(content);
            $('#viewDataModal').modal('show');
        }

</script>
</body>
</html>
